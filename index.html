<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="/favicon.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta name="theme-color" content="#ffe0b3"/>
    <meta
            name="description"
            content="Learn languages while reading what you ðŸ§¡ like"
    />

    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Zeeguu">

    <base href="/"/>

    <link rel="apple-touch-icon" href="/logo192.png"/>
    <link rel="manifest" href="/manifest.json"/>
    <!-- Google Fonts with extended character support (latin-ext, greek, cyrillic) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <title>Zeeguu</title>
</head>

<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div id="root"></div>
<script type="module" src="/src/index.js"></script>
<script>
    function getSessionID() {
        const cookies = document.cookie
            .split(";")
            .map((cookie) => cookie.trim());
        for (const cookie of cookies) {
            if (cookie.startsWith("sessionID")) {
                return cookie.split("=")[1];
            }
        }

        return null;
    }

    if ("serviceWorker" in navigator) {
        // Handle PWA updates - reload when service worker takes control
        navigator.serviceWorker.addEventListener('controllerchange', () => {
            console.log('Service worker updated, reloading page...');
            window.location.reload();
        });

        navigator.serviceWorker
            .register("/service-worker.js")
            .then((registration) => {
                const sessionId = getSessionID();
                if (sessionId) {
                    navigator.serviceWorker.ready.then((registration) => {
                        registration.active.postMessage({
                            sessionId: sessionId,
                        });
                        console.log("Service worker registered successfully");
                    });
                } else {
                    console.error("No session ID found");
                }
            })
            .catch((error) => {
                console.error("Failed to register service worker:", error);
            });
    }

</script>
</body>
</html>
